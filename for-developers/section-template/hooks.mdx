---
title: 'Hooks'
description: 'Complete guide to hooks in Glood.AI section templates'
---

# Template Hooks

## 1. Hook Lifecycle Flow

### Section Initialization Phase
- `initSection` is called when section is first created
  - Sets up initial state and variables
  - Configures section parameters
  - Initializes custom features
  - Prepares recommendation engine
  - Registers event listeners

### Data Fetching Phase
- `getProductFetchQuery` is called to prepare GraphQL query
  - Defines required product fields
  - Sets up query variables
  - Configures custom data requirements
  - Handles pagination if needed
  - Sets up filtering parameters

### Data Processing Phase
- `postProductFetch` processes raw product data
  - Filters products if needed
  - Adds computed properties
  - Transforms data structure
  - Handles currency formatting
  - Prepares variant data
- `transformProductData` transforms individual product data
  - Normalizes data format
  - Adds custom fields
  - Prepares for rendering
  - Handles translations
  - Sets up tracking data

### Rendering Phase
- `afterSectionRendered` is called once DOM is ready
  - Sets up DOM event listeners
  - Initializes UI components
  - Triggers animations
  - Sets up lazy loading
  - Handles responsive behavior
- `initSwiper` (if carousel is enabled)
  - Configures carousel settings
  - Sets up navigation
  - Initializes responsive behavior
  - Sets up pagination
  - Configures autoplay

### Interaction Phase
- `onVariantChange` handles variant selection
  - Updates product options
  - Refreshes pricing
  - Updates availability
  - Updates images
  - Handles inventory status
- `onSwatchChange` handles swatch interactions
  - Updates product images
  - Refreshes variant selection
  - Updates UI state
  - Handles color mapping
  - Updates availability

### Cart Operation Phase
- `beforeAddToCart` validates cart operations
  - Validates product selection
  - Checks inventory
  - Modifies cart payload
  - Handles quantity validation
  - Prepares tracking data
- `afterAddToCart` handles post-cart updates
  - Updates UI
  - Shows notifications
  - Refreshes cart state
  - Updates inventory
  - Triggers analytics

### Cleanup Phase
- Cleanup operations when section is removed/updated
  - Remove event listeners
  - Clear custom elements
  - Reset state if needed
  - Clear timers/intervals
  - Free up resources

## 2. Available Hooks

### initSection
**Description:**  
Primary initialization hook called when a section is first created.

**Parameters:**  
- `args` (Object):
  - `recommendation` (Object): Section configuration
  - `engine` (Object): Recommendation engine instance
  - `initEnginePayload` (Object): Initial engine data
- `cb` (Function): Callback function
- `gloodUtils` (Object): Utility functions

**Returns:**  
void

**Example:**
```javascript
initSection: (args, cb, gloodUtils) => {
    const { recommendation, engine } = args;
    setupSection(recommendation);
    cb();
}
```

**Use Cases:**
- Section configuration
- State initialization
- Event listener setup
- Feature initialization
- Engine configuration

### getProductFetchQuery
**Description:**  
Builds the GraphQL query for fetching product data.

**Parameters:**  
- `recommendation` (Object): Section configuration
- `glood` (Object): Global store configuration

**Returns:**  
String - GraphQL query

**Example:**
```javascript
getProductFetchQuery: (recommendation, glood) => {
    return `
        query ProductData($id: ID!) {
            product(id: $id) {
                title
                handle
                variants(first: 250) {
                    nodes {
                        id
                        price
                        available
                    }
                }
            }
        }
    `;
}
```

**Use Cases:**
- Product data fetching
- Field selection
- Query customization
- Data filtering
- Performance optimization

### postProductFetch
**Description:**  
Processes raw product data after fetching. Allows for data transformation and enrichment before rendering.

**Parameters:**  
- `args` (Object):
  - `products` (Array): Raw product data array
  - `recommendation` (Object): Section configuration
  - `template` (Object): Template settings
- `utils` (Object): Helper functions

**Returns:**  
Array - Processed product data

**Example:**
```javascript
postProductFetch: (args, utils) => {
    const { products, recommendation, template } = args;
    return products.map(product => ({
        ...product,
        formattedPrice: utils.formatMoney(product.price),
        hasDiscount: product.compare_at_price > product.price,
        isAvailable: product.variants.nodes[0].availableForSale,
        imageUrl: utils.optimizeImage(product.featured_image, template.settings)
    }));
}
```

**Use Cases:**
- Price formatting
- Discount calculations
- Image optimization
- Availability checks
- Data enrichment

### transformProductData
**Description:**  
Transforms individual product data before rendering. Last chance to modify product data.

**Parameters:**  
- `product` (Object): Single product data
- `recommendation` (Object): Section configuration
- `utils` (Object): Helper functions

**Returns:**  
Object - Modified product data

**Example:**
```javascript
transformProductData: (product, recommendation, utils) => {
    return {
        ...product,
        trackingData: utils.generateTrackingData(product, recommendation),
        variants: product.variants.map(variant => ({
            ...variant,
            formattedPrice: utils.formatMoney(variant.price),
            isAvailable: variant.inventory_quantity > 0
        })),
        labels: utils.generateProductLabels(product, recommendation.settings)
    };
}
```

**Use Cases:**
- Tracking setup
- Variant processing
- Label generation
- Price formatting
- Custom field addition

### afterSectionRendered
**Description:**  
Called after section DOM is ready. Perfect for initializing UI components and interactions.

**Parameters:**  
- `args` (Object):
  - `container` (HTMLElement): Section container
  - `recommendation` (Object): Section configuration
  - `products` (Array): Processed products
- `utils` (Object): Helper functions

**Returns:**  
void

**Example:**
```javascript
afterSectionRendered: (args, utils) => {
    const { container, recommendation, products } = args;
    
    // Initialize carousel if needed
    if (recommendation.layout === 'carousel') {
        initCarousel(container, recommendation.settings.carousel);
    }
    
    // Set up lazy loading
    utils.setupLazyLoading(container);
    
    // Initialize product cards
    products.forEach(product => {
        initializeProductCard(container, product);
    });
    
    // Set up observers
    setupIntersectionObserver(container);
}
```

**Use Cases:**
- Carousel initialization
- Lazy loading setup
- Event binding
- Animation setup
- Observer initialization

## 3. Hook Dependencies

### Required Utils
- `formatMoney`: Price formatting
- `getVariantById`: Variant lookup
- `updateUrl`: URL manipulation
- `merge`: Object merging
- `imageOptimizer`: Image optimization

### Global Context
- `glood`: Store configuration
- `translations`: Text strings
- `template`: Template settings
- `section`: Section configuration
- `utils`: Common utilities

### Hook Flow Dependencies
- `transformProductData` needs data from `getProductFetchQuery`
- `afterSectionRendered` needs data from `transformProductData`
- Cart operations need data from `onVariantChange`
- Swiper needs container from `afterSectionRendered`

### Error Handling
Each hook should handle errors appropriately:
1. Initialization errors: Use default configuration
2. Data fetching errors: Show fallback content
3. Processing errors: Maintain data integrity
4. Rendering errors: Graceful degradation
5. Interaction errors: User feedback 